<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Job Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', Arial, sans-serif; background: #f5f7fa; margin: 0; padding: 0; min-height: 100vh;}
    .dashboard { margin: 30px auto 0 auto; max-width: 1100px; padding: 0 16px 40px 16px;}
    .menu-squares { display:flex; flex-wrap:wrap; gap:20px; margin-bottom:30px; }
    .menu-square { width:160px; height:160px; display:flex;align-items:center;justify-content:center;font-size:1.2rem;font-weight:bold;border-radius:18px;cursor:pointer;user-select:none;box-shadow:0 2px 8px #8883;}
    .orange-gradient{background: radial-gradient(circle at 65% 35%, #fff 60px, #ffb347 110px, #ff9800 100%);}
    .blue-gradient{background: radial-gradient(circle at 60% 30%, #fff 60px, #71c7ec 110px, #2792c3 100%);}
    .green-gradient{background: radial-gradient(circle at 40% 30%, #fff 60px, #8de7b5 110px, #1eae60 100%);}
    .purple-gradient{background: radial-gradient(circle at 65% 35%, #fff 60px, #c3a3fc 110px, #7e46c5 100%);}
    .calendar-gradient{background: radial-gradient(circle at 50% 40%, #fff 60px, #ffe082 110px, #ffca28 100%);}
    .profile-gradient{background: radial-gradient(circle at 30% 70%, #fff 60px, #b3f6ea 110px, #00bfae 100%);}
    .details-section { background:#fff; border-radius:14px; padding:30px 22px 22px 22px; box-shadow:0 2px 18px #8882; margin-bottom:24px; max-width:940px; width:100%;}
    label { display:block; margin-bottom:10px; }
    input[type="text"], input[type="email"], input[type="password"], input[type="color"], input[type="time"], select, textarea {
      display:block; width:100%; max-width:350px; margin-top:3px; margin-bottom:7px; padding:7px; border-radius:5px; border:1px solid #ccc;}
    textarea { min-height:40px;}
    button { margin-top:5px; padding:7px 14px; border-radius:7px; border:none; background:#1976d2; color:#fff; font-weight:600; cursor:pointer;}
    .admin-section { margin-bottom:32px; }
    .admin-worker-block, .admin-cal-event, .submission-block { background:#f6f9fa; border-radius:7px; margin-bottom:10px; padding:8px 14px; }
    .admin-cal-event { border-left:7px solid #ffb347; }
    .admin-worker-block { border-left:7px solid #1eae60; }
    .shift-buttons { display:flex; gap:9px; margin:7px 0; }
    .profile-header { display:flex; align-items:center; gap:22px; margin-bottom:10px;}
    .profile-header h3 { margin:0; font-size:1.24rem; font-family:'Montserrat', Arial, sans-serif; color:#04786f;}
    .profile-logout-btn { background:#b3f6ea; color:#04786f; border:none; border-radius:6px; font-size:0.98rem; font-family:'Montserrat', Arial, sans-serif; font-weight:700; padding:8px 15px; cursor:pointer; margin-left:auto;}
    .profile-history-scroll { max-height:180px; overflow-y:auto; border-radius:10px; background:#f6f9fa; box-shadow:0 1px 8px 0 rgba(80,90,110,0.07); padding:15px 12px; margin-top:8px;}
    .shift-history-block { margin-bottom:12px; background:#e6fefb; padding:11px 12px 7px 12px; border-radius:7px;}
    .shift-history-block ul { margin:3px 0 0 0; padding-left:18px; font-size:0.98rem;}
    .shift-history-block li { margin-bottom:2px;}
    .profile-field-edit-btn, .profile-field-save-btn, .profile-field-cancel-btn {
      background: none;
      border: none;
      color: #1976d2;
      cursor: pointer;
      font-size: 1.1em;
      margin-left: 6px;
      padding: 0 4px;
      vertical-align: middle;
    }
    .profile-field-edit-btn:hover, .profile-field-save-btn:hover, .profile-field-cancel-btn:hover {
      color: #0d4da1;
    }
    .edit-shift-history-modal {
      position:fixed;top:0;left:0;right:0;bottom:0;background:#0006;
      display:flex;justify-content:center;align-items:center;z-index:10;
    }
    .edit-shift-history-modal-content {
      background:#fff;padding:25px 22px;border-radius:11px;min-width:300px;max-width:98vw;
    }
    .hidden { display:none; }
    .shift-square { width:160px; height:120px; display:flex;align-items:center;justify-content:center;font-size:1.1rem;font-weight:600;border-radius:10px; box-shadow: 0 1px 5px #8882; margin:8px; text-align:center;}
    .announcements-list { margin: 0 0 0 20px; padding: 0; font-size: 1.08rem;}
    .announcements-list li { margin-bottom: 6px; line-height: 1.33;}
    .calendar-toolbar { margin-bottom: 14px; display:flex;align-items:center;gap:10px;}
    .calendar-container {overflow-x:auto;background:#fafdff;border-radius:10px;box-shadow:0 1px 8px #8881;padding:7px 2px;}
    .calendar-grid { font-size:0.98em;}
    .cal-row { display: flex; }
    .cal-cell {
      min-width: 96px;
      min-height: 40px;
      border-bottom: 1px solid #e4eaf2;
      border-right: 1px solid #e4eaf2;
      position: relative;
      background: #fafdff;
    }
    .cal-cell.cal-time {
      min-width: 56px;
      background: #f6f9fa;
      color: #888;
      font-size: 0.98rem;
      text-align: right;
      padding-right: 5px;
      border-right: 1px solid #e4eaf2;
    }
    .cal-row.cal-header .cal-cell {
      background: #f3f6fb;
      color: #1976d2;
      font-weight: 700;
      font-size: 1rem;
      border-bottom: 2px solid #c3a3fc;
    }
    .cal-row .cal-cell:last-child { border-right: none; }
    .cal-row:last-child .cal-cell { border-bottom: none; }
    .cal-event-block {
      position: absolute;
      left: 7px;
      right: 7px;
      z-index: 2;
      display: flex;
      align-items: center;
      padding-left: 7px;
      border-radius: 7px;
      background: #ffb347;
      color: #333;
      font-size: 0.98rem;
      box-shadow: 0 1px 5px #8883;
      min-height: 36px;
      max-width: 100%;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="menu-squares">
      <div class="menu-square orange-gradient" id="shifts-square"><span>Shifts</span></div>
      <div class="menu-square blue-gradient" id="announcements-square"><span>Announcements</span></div>
      <div class="menu-square green-gradient" id="hire-square"><span>Apply for Hire</span></div>
      <div class="menu-square purple-gradient" id="admin-square"><span>Admin</span></div>
      <div class="menu-square calendar-gradient" id="calendar-square"><span>Calendar</span></div>
      <div class="menu-square profile-gradient" id="profile-square"><span>Manage Your Profile</span></div>
    </div>
    <!-- Profile Section -->
    <div class="details-section hidden" id="profile-details-section">
      <h2>Manage Your Profile</h2>
      <div id="profile-login-section">
        <form id="profile-login-form" class="profile-login-form">
          <label>
            Username:
            <input type="text" id="profile-login-username" maxlength="24" required autocomplete="username">
          </label>
          <label>
            Password:
            <input type="password" id="profile-login-password" maxlength="32" required autocomplete="current-password">
          </label>
          <button type="submit">Login</button>
          <div class="form-message" id="profile-login-message"></div>
        </form>
      </div>
      <div id="profile-main-section" class="hidden">
        <div class="profile-header">
          <h3>
            <span id="profile-name-display"></span>
            <input type="text" id="profile-name-edit" class="hidden" style="font-size:1.09em;">
            <button id="edit-profile-name-btn" class="profile-field-edit-btn" title="Edit Name" type="button">‚úèÔ∏è</button>
            <button id="save-profile-name-btn" class="profile-field-save-btn hidden" type="button">üíæ</button>
            <button id="cancel-profile-name-btn" class="profile-field-cancel-btn hidden" type="button">‚úñÔ∏è</button>
          </h3>
          <button id="profile-logout-btn" class="profile-logout-btn">Logout</button>
        </div>
        <div class="profile-info">
          <div>
            <b>Schedule:</b>
            <span id="profile-schedule-display"></span>
            <input type="text" id="profile-schedule-edit" class="hidden" style="font-size:.97em;">
            <button id="edit-profile-schedule-btn" class="profile-field-edit-btn" title="Edit Shift" type="button">‚úèÔ∏è</button>
            <button id="save-profile-schedule-btn" class="profile-field-save-btn hidden" type="button">üíæ</button>
            <button id="cancel-profile-schedule-btn" class="profile-field-cancel-btn hidden" type="button">‚úñÔ∏è</button>
          </div>
          <div>
            <b>Lunch Break:</b>
            <span id="profile-lunch-display"></span>
            <input type="text" id="profile-lunch-edit" class="hidden" style="font-size:.97em;">
            <button id="edit-profile-lunch-btn" class="profile-field-edit-btn" title="Edit Lunch" type="button">‚úèÔ∏è</button>
            <button id="save-profile-lunch-btn" class="profile-field-save-btn hidden" type="button">üíæ</button>
            <button id="cancel-profile-lunch-btn" class="profile-field-cancel-btn hidden" type="button">‚úñÔ∏è</button>
          </div>
          <div>
            <b>Experience:</b>
            <span id="profile-experience-display"></span>
            <textarea id="profile-experience-edit" class="hidden" style="width:98%;font-size:.97em;" rows="2"></textarea>
            <button id="edit-profile-experience-btn" class="profile-field-edit-btn" title="Edit Experience" type="button">‚úèÔ∏è</button>
            <button id="save-profile-experience-btn" class="profile-field-save-btn hidden" type="button">üíæ</button>
            <button id="cancel-profile-experience-btn" class="profile-field-cancel-btn hidden" type="button">‚úñÔ∏è</button>
          </div>
        </div>
        <div>
          <h4>Shift History</h4>
          <div class="profile-history-scroll" id="profile-shift-history"></div>
          <button id="add-shift-entry-btn" type="button" style="margin-top:8px;">Add Entry</button>
        </div>
        <div id="edit-shift-history-modal" class="hidden edit-shift-history-modal">
          <div class="edit-shift-history-modal-content">
            <h4>Edit Shift Entry</h4>
            <form id="shift-history-edit-form">
              <label>Date: <input type="date" id="shift-edit-date" required></label>
              <label>Clock In: <input type="time" id="shift-edit-in"></label>
              <label>Break Start: <input type="time" id="shift-edit-breakstart"></label>
              <label>Break End: <input type="time" id="shift-edit-breakend"></label>
              <label>Clock Out: <input type="time" id="shift-edit-out"></label>
              <div style="margin-top:10px;">
                <button type="submit">Save</button>
                <button type="button" id="cancel-shift-edit-btn">Cancel</button>
                <button type="button" id="delete-shift-edit-btn" style="float:right;background:#d32f2f;">Delete Entry</button>
              </div>
            </form>
          </div>
        </div>
        <div id="profile-message" class="form-message"></div>
        <!-- Profile clock-in/out, break, and shift controls will be filled in JS -->
        <div id="shift-control-block" style="margin-top:26px;">
          <div><b>Today's Shift:</b> <span id="profile-current-shift"></span></div>
          <div class="shift-buttons">
            <button id="clock-in-btn">Clock In</button>
            <button id="start-break-btn" disabled>Start Break</button>
            <button id="end-break-btn" disabled>End Break</button>
            <button id="clock-out-btn" disabled>Clock Out</button>
          </div>
          <div id="shift-status"></div>
        </div>
      </div>
    </div>
    <!-- Calendar Section -->
    <div class="details-section hidden" id="calendar-details">
      <h2>Weekly Calendar</h2>
      <div class="calendar-toolbar">
        <button id="calendar-today-btn">Today</button>
        <span class="calendar-week-label" id="calendar-week-label"></span>
        <button id="calendar-prev-btn">&#8592;</button>
        <button id="calendar-next-btn">&#8594;</button>
      </div>
      <div class="calendar-container" id="calendar-container">
        <div class="calendar-grid" id="calendar-grid"></div>
      </div>
    </div>
    <!-- Shifts Section -->
    <div class="details-section hidden" id="shifts-details">
      <h2>Shifts</h2>
      <div class="shift-squares" id="shift-squares"></div>
      <div class="profile-details" id="profile-details">
        <h3>Click a profile to see shift details</h3>
      </div>
    </div>
    <!-- Announcements Section -->
    <div class="details-section hidden" id="announcements-details">
      <h2>Announcements</h2>
      <ul class="announcements-list" id="announcements-list"></ul>
    </div>
    <!-- Hire Section -->
    <div class="details-section hidden" id="hire-details">
      <h2>Apply for Hire</h2>
      <form class="hire-form" id="hire-form">
        <label>1. Full Name:<input type="text" name="name" required autocomplete="name"></label>
        <label>2. Email Address:<input type="email" name="email" required autocomplete="email"></label>
        <label>3. Phone Number:<input type="text" name="phone" required autocomplete="tel"></label>
        <label>4. Why do you want this job?<textarea name="why" rows="2" required></textarea></label>
        <label>5. What relevant experience do you have?<textarea name="experience" rows="2" required></textarea></label>
        <label>6. What are your strengths?<textarea name="strengths" rows="2" required></textarea></label>
        <label>7. What are your weaknesses?<textarea name="weaknesses" rows="2" required></textarea></label>
        <label>8. What is your availability (days and times)?<input type="text" name="availability" required></label>
        <label>9. Which shift would you prefer?
          <select name="shift" required>
            <option value="">Select...</option>
            <option>Morning (6am-2pm)</option>
            <option>Day (9am-5pm)</option>
            <option>Evening (1pm-9pm)</option>
          </select>
        </label>
        <label>10. Are you willing to work weekends?
          <select name="weekends" required>
            <option value="">Select...</option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
            <option value="maybe">Maybe</option>
          </select>
        </label>
        <label>11. Tell us about a time you overcame a challenge:<textarea name="challenge" rows="2" required></textarea></label>
        <label>12. Emergency Contact Name & Number:<input type="text" name="emergency" required></label>
        <button type="submit">Submit Application</button>
        <div class="form-message" id="form-message"></div>
      </form>
    </div>
    <!-- Admin Section -->
    <div class="details-section hidden" id="admin-details">
      <h2>Admin Access</h2>
      <div id="admin-login">
        <label>
          Enter admin code:
          <input type="password" id="admin-code" maxlength="32">
        </label>
        <button id="admin-login-btn">Login</button>
        <div id="admin-login-message" style="color: #b32d2d; margin-top: 8px;"></div>
      </div>
      <div id="admin-panel" class="hidden">
        <div class="admin-section">
          <h3>Change Admin Code</h3>
          <label>
            New admin code:
            <input type="password" id="new-admin-code">
          </label>
          <button id="change-admin-code-btn">Change Code</button>
          <div id="admin-code-message" style="margin-top:8px;"></div>
        </div>
        <div class="admin-section">
          <h3>Change Profile Passwords</h3>
          <div id="admin-profile-passwords"></div>
        </div>
        <div class="admin-section">
          <h3>Manage Workers</h3>
          <div id="admin-workers-list"></div>
          <button id="add-worker-btn">Add Worker</button>
          <div id="add-worker-form" class="hidden">
            <label>Name: <input type="text" id="new-worker-name"></label>
            <label>Shift: <input type="text" id="new-worker-shift"></label>
            <label>Tasks (comma separated): <input type="text" id="new-worker-tasks"></label>
            <button id="save-new-worker-btn">Save Worker</button>
            <button id="cancel-new-worker-btn">Cancel</button>
          </div>
        </div>
        <div class="admin-section">
          <h3>Manage Announcements</h3>
          <ul id="admin-announcements-list"></ul>
          <input type="text" id="admin-new-announcement" placeholder="Add announcement">
          <button id="admin-add-announcement-btn">Add</button>
        </div>
        <div class="admin-section">
          <h3>Manage Calendar</h3>
          <div id="admin-calendar-list"></div>
          <form id="admin-add-calendar-form" class="admin-cal-form">
            <label>Title: <input type="text" id="admin-cal-title" required></label>
            <label>Day:
              <select id="admin-cal-day" required>
                <option value="0">Monday</option>
                <option value="1">Tuesday</option>
                <option value="2">Wednesday</option>
                <option value="3">Thursday</option>
                <option value="4">Friday</option>
                <option value="5">Saturday</option>
                <option value="6">Sunday</option>
              </select>
            </label>
            <label>Start Time:
              <input type="time" id="admin-cal-start" min="06:00" max="21:00" required>
            </label>
            <label>End Time:
              <input type="time" id="admin-cal-end" min="06:00" max="21:00" required>
            </label>
            <label>Color:
              <input type="color" id="admin-cal-color" value="#ffb347" required>
            </label>
            <button type="submit">Add Event</button>
          </form>
        </div>
        <div class="admin-section">
          <h3>Manage Submissions</h3>
          <div id="submissions-section">
            <div id="submissions-list"></div>
          </div>
        </div>
        <div class="admin-section">
          <h3>Manage Profiles</h3>
          <div id="admin-profiles-list"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
// ========== DATA STORAGE HELPERS ==========
const defaultWorkers = [
  { name: "John Doe", shift: "9:00 AM - 5:00 PM", tasks: [
    "Front desk coverage from 9am-12pm",
    "Inventory check at 2pm",
    "Daily report submission by 4:30pm",
    "Assist with onboarding new employees"
  ]},
  { name: "Jane Doe", shift: "1:00 PM - 9:00 PM", tasks: [
    "Supervise afternoon crew",
    "Prepare conference room for meetings",
    "Coordinate with cleaning staff",
    "Update task board at end of shift"
  ]},
  { name: "Bob Smith", shift: "6:00 AM - 2:00 PM", tasks: [
    "Early morning inventory restock",
    "Equipment maintenance at 9am",
    "Handle supplier deliveries",
    "Submit maintenance logs by 1:30pm"
  ]}
];
function getWorkers() {
  return JSON.parse(localStorage.getItem('workers') || JSON.stringify(defaultWorkers));
}
function setWorkers(workers) {
  localStorage.setItem('workers', JSON.stringify(workers));
}

const defaultAnnouncements = [
  "Team lunch on Friday at 1pm in the main cafeteria.",
  "Reminder: Submit weekly reports by Thursday 5pm.",
  "Fire drill scheduled for next Monday at 10am."
];
function getAnnouncements() {
  return JSON.parse(localStorage.getItem('announcements') || JSON.stringify(defaultAnnouncements));
}
function setAnnouncements(list) {
  localStorage.setItem('announcements', JSON.stringify(list));
}
function getAdminCode() {
  return localStorage.getItem('adminCode') || "1234";
}
function setAdminCode(newCode) {
  localStorage.setItem('adminCode', newCode);
}
function getSubmissions() {
  return JSON.parse(localStorage.getItem('hireSubmissions') || '[]');
}
function setSubmissions(subs) {
  localStorage.setItem('hireSubmissions', JSON.stringify(subs));
}
function saveSubmission(data) {
  const subs = getSubmissions();
  subs.push(data);
  setSubmissions(subs);
}
const defaultCalendarEvents = [
  { title: "John Shift", day: 0, start: 9, end: 17, color: "#ffb347" },
  { title: "Jane Shift", day: 1, start: 13, end: 21, color: "#71c7ec" },
  { title: "Bob Shift", day: 2, start: 6, end: 14, color: "#8de7b5" },
  { title: "Team Lunch", day: 4, start: 13, end: 14, color: "#c3a3fc" },
  { title: "Fire Drill", day: 0, start: 10, end: 11, color: "#ff9800" },
  { title: "Manager Meeting", day: 3, start: 15, end: 16.5, color: "#7e46c5" }
];
function getCalendarEvents() {
  return JSON.parse(localStorage.getItem('calendarEvents') || JSON.stringify(defaultCalendarEvents));
}
function setCalendarEvents(events) {
  localStorage.setItem('calendarEvents', JSON.stringify(events));
}

// =========== SHIFTS SECTION ===========
function renderShiftSquares() {
  const workers = getWorkers();
  const shiftSquares = document.getElementById('shift-squares');
  shiftSquares.innerHTML = '';
  workers.forEach((worker, idx) => {
    const colors = ['orange-gradient', 'blue-gradient', 'green-gradient', 'purple-gradient'];
    const color = colors[idx % colors.length];
    const div = document.createElement('div');
    div.className = `shift-square ${color}`;
    div.innerHTML = `<span>${worker.name}</span>`;
    div.addEventListener('click', () => {
      renderProfileDetails(worker);
    });
    shiftSquares.appendChild(div);
  });
}
function renderProfileDetails(worker) {
  const profileDetails = document.getElementById('profile-details');
  profileDetails.innerHTML = `
    <h3>${worker.name}</h3>
    <p><strong>Shift:</strong> ${worker.shift}</p>
    <ul>
      ${worker.tasks.map(task => `<li>${task}</li>`).join('')}
    </ul>
  `;
}

// =========== ANNOUNCEMENTS ===========
function renderAnnouncements() {
  const list = getAnnouncements();
  const annList = document.getElementById('announcements-list');
  annList.innerHTML = '';
  list.forEach(a => {
    const li = document.createElement('li');
    li.textContent = a;
    annList.appendChild(li);
  });
}

// =========== ADMIN ANNOUNCEMENTS ===========
function renderAdminAnnouncements() {
  const list = getAnnouncements();
  const annList = document.getElementById('admin-announcements-list');
  annList.innerHTML = '';
  list.forEach((a, i) => {
    const li = document.createElement('li');
    li.innerHTML = `
      <span class="admin-announcement-text" contenteditable="true" data-idx="${i}">${a}</span>
      <button class="delete-announcement-btn" data-idx="${i}">Delete</button>
    `;
    annList.appendChild(li);
  });
}

// =========== ADMIN WORKERS ===========
function renderAdminWorkers() {
  const workers = getWorkers();
  const div = document.getElementById('admin-workers-list');
  div.innerHTML = '';
  workers.forEach((worker, idx) => {
    const workerDiv = document.createElement('div');
    workerDiv.className = "admin-worker-block";
    workerDiv.innerHTML = `
      <b>${worker.name}</b> (<span>${worker.shift}</span>)
      <button class="edit-worker-btn" data-idx="${idx}">Edit</button>
      <button class="delete-worker-btn" data-idx="${idx}">Delete</button>
      <div class="admin-worker-tasks"><ul>${worker.tasks.map(t=>`<li>${t}</li>`).join('')}</ul></div>
      <div class="edit-worker-form hidden" id="edit-worker-form-${idx}">
        <label>Name: <input type="text" value="${worker.name}" class="edit-worker-name"></label>
        <label>Shift: <input type="text" value="${worker.shift}" class="edit-worker-shift"></label>
        <label>Tasks (comma separated): <input type="text" value="${worker.tasks.join(', ')}" class="edit-worker-tasks-input"></label>
        <button class="save-edit-worker-btn" data-idx="${idx}">Save</button>
        <button class="cancel-edit-worker-btn" data-idx="${idx}">Cancel</button>
      </div>
    `;
    div.appendChild(workerDiv);
  });
}

// =========== ADMIN SUBMISSIONS ===========
function renderAdminSubmissions() {
  const subs = getSubmissions();
  const list = document.getElementById('submissions-list');
  if(subs.length === 0) {
    list.innerHTML = "<em>No submissions yet.</em>";
    return;
  }
  list.innerHTML = subs.map((s, i) => `
    <div class="submission-block">
      <strong>Application #${i+1}</strong>
      <button class="delete-submission-btn" data-idx="${i}">Delete</button>
      <ul>
        <li><b>Full Name:</b> ${s.name}</li>
        <li><b>Email:</b> ${s.email}</li>
        <li><b>Phone:</b> ${s.phone}</li>
        <li><b>Why do you want this job?</b> ${s.why}</li>
        <li><b>Relevant experience:</b> ${s.experience}</li>
        <li><b>Strengths:</b> ${s.strengths}</li>
        <li><b>Weaknesses:</b> ${s.weaknesses}</li>
        <li><b>Availability:</b> ${s.availability}</li>
        <li><b>Preferred shift:</b> ${s.shift}</li>
        <li><b>Willing to work weekends:</b> ${s.weekends}</li>
        <li><b>Challenge overcome:</b> ${s.challenge}</li>
        <li><b>Emergency contact:</b> ${s.emergency}</li>
      </ul>
    </div>
  `).join("");
}

// =========== ADMIN PROFILES MANAGEMENT ===========
function renderAdminProfiles() {
  const profiles = getProfiles();
  const container = document.getElementById('admin-profiles-list');
  if (!container) return;
  if (Object.keys(profiles).length === 0) {
    container.innerHTML = "<em>No user profiles found.</em>";
    return;
  }
  container.innerHTML = Object.entries(profiles).map(([key, profile]) => `
    <div class="admin-worker-block" style="margin-bottom:20px;">
      <b>User:</b> <span>${profile.username}</span>
      <button onclick="editAdminProfile('${key}')">Edit</button>
      <button onclick="deleteAdminProfile('${key}')">Delete User</button>
      <div id="admin-profile-edit-${key}" class="hidden" style="margin:12px 0;">
        <label>Name: <input type="text" id="admin-edit-name-${key}" value="${profile.name}"></label>
        <label>Username: <input type="text" id="admin-edit-username-${key}" value="${profile.username}"></label>
        <label>Password: <input type="text" id="admin-edit-password-${key}" value="${profile.password}"></label>
        <label>Schedule: <input type="text" id="admin-edit-schedule-${key}" value="${profile.schedule || ""}"></label>
        <label>Lunch: <input type="text" id="admin-edit-lunch-${key}" value="${profile.lunch || ""}"></label>
        <label>Experience: <textarea id="admin-edit-experience-${key}">${profile.experience || ""}</textarea></label>
        <label>Jobs (JSON): <textarea id="admin-edit-jobs-${key}" rows="2">${JSON.stringify(profile.jobs || [])}</textarea></label>
        <button onclick="saveAdminProfile('${key}')">Save</button>
        <button onclick="cancelAdminProfileEdit('${key}')">Cancel</button>
        <h5>Shift History:</h5>
        <div>${(profile.history && profile.history.length>0) ? profile.history.map((s, i) =>
          `<div style='background:#e6fefb;margin-bottom:7px;border-radius:6px;padding:6px 10px;'>
            <b>${s.date || "-"}:</b> 
            <span>In: ${s.clockIn || "-"}, Break: ${s.breakStart || "-"} - ${s.breakEnd || "-"}, Out: ${s.clockOut || "-"}</span>
            <button onclick="deleteAdminProfileShift('${key}',${i})" style="float:right;background:#cf222e;color:#fff;">Delete</button>
          </div>`
        ).join("") : "<em>No shift history</em>"}</div>
      </div>
    </div>
  `).join('');
}
window.editAdminProfile = function(key) {
  document.getElementById(`admin-profile-edit-${key}`).classList.remove('hidden');
};
window.cancelAdminProfileEdit = function(key) {
  document.getElementById(`admin-profile-edit-${key}`).classList.add('hidden');
};
window.saveAdminProfile = function(key) {
  const profiles = getProfiles();
  // Old and potentially new username
  const oldKey = key;
  const newUsername = document.getElementById(`admin-edit-username-${key}`).value.trim();
  // If username changed, we must change the object key
  let newKey = oldKey;
  if (newUsername && newUsername !== profiles[oldKey].username) {
    newKey = newUsername;
    if (profiles[newKey]) {
      alert("This username is already taken.");
      return;
    }
    profiles[newKey] = {...profiles[oldKey]};
    delete profiles[oldKey];
  }
  profiles[newKey].username = newUsername;
  profiles[newKey].name = document.getElementById(`admin-edit-name-${key}`).value.trim();
  profiles[newKey].password = document.getElementById(`admin-edit-password-${key}`).value;
  profiles[newKey].schedule = document.getElementById(`admin-edit-schedule-${key}`).value;
  profiles[newKey].lunch = document.getElementById(`admin-edit-lunch-${key}`).value;
  profiles[newKey].experience = document.getElementById(`admin-edit-experience-${key}`).value;
  try {
    profiles[newKey].jobs = JSON.parse(document.getElementById(`admin-edit-jobs-${key}`).value || "[]");
  } catch(e) {
    alert("Jobs must be a valid JSON array.");
    return;
  }
  setProfiles(profiles);
  renderAdminProfiles();
};
window.deleteAdminProfile = function(key) {
  if (!confirm("Delete this user and all their data?")) return;
  const profiles = getProfiles();
  delete profiles[key];
  setProfiles(profiles);
  renderAdminProfiles();
};
window.deleteAdminProfileShift = function(key, i) {
  const profiles = getProfiles();
  if (!profiles[key] || !profiles[key].history) return;
  profiles[key].history.splice(i, 1);
  setProfiles(profiles);
  renderAdminProfiles();
};
// ========== PROFILE DATA & LOGIC ==========

const defaultProfiles = {
  john: {
    username: "john",
    password: "johnpass",
    name: "John Doe",
    schedule: "Mon-Fri, 9:00 AM - 5:00 PM",
    lunch: "12:30 PM - 1:00 PM",
    experience: "Front desk, Inventory, Customer Service",
    jobs: [
      { title: "Front Desk Clerk", duration: "2 yrs", hours: "9am-5pm", lunch: "12:30-1:00" }
    ],
    history: []
  },
  jane: {
    username: "jane",
    password: "janepass",
    name: "Jane Doe",
    schedule: "Tue-Sat, 1:00 PM - 9:00 PM",
    lunch: "5:00 PM - 5:30 PM",
    experience: "Supervisor, Staff Trainer",
    jobs: [
      { title: "Supervisor", duration: "3 yrs", hours: "1pm-9pm", lunch: "5:00-5:30" }
    ],
    history: []
  },
  bob: {
    username: "bob",
    password: "bobpass",
    name: "Bob Smith",
    schedule: "Mon-Fri, 6:00 AM - 2:00 PM",
    lunch: "10:00 AM - 10:30 AM",
    experience: "Maintenance, Deliveries",
    jobs: [
      { title: "Maintenance", duration: "4 yrs", hours: "6am-2pm", lunch: "10:00-10:30" }
    ],
    history: []
  }
};
function getProfiles() {
  return JSON.parse(localStorage.getItem('profiles') || JSON.stringify(defaultProfiles));
}
function setProfiles(profiles) {
  localStorage.setItem('profiles', JSON.stringify(profiles));
}
function getProfileByUsername(username) {
  const profiles = getProfiles();
  for (const key in profiles) {
    if (profiles[key].username === username) return {key, ...profiles[key]};
  }
  return null;
}
function updateProfileHistory(profileKey, shift) {
  const profiles = getProfiles();
  profiles[profileKey].history.unshift(shift);
  setProfiles(profiles);
}
let currentProfileKey = null;
let currentShift = null;
function showProfileLogin() {
  document.getElementById('profile-login-section').classList.remove('hidden');
  document.getElementById('profile-main-section').classList.add('hidden');
  document.getElementById('profile-login-username').value = '';
  document.getElementById('profile-login-password').value = '';
  document.getElementById('profile-login-message').textContent = '';
  currentProfileKey = null;
  currentShift = null;
}
function showProfileMain(profileKey) {
  currentProfileKey = profileKey;
  const profiles = getProfiles();
  const profile = profiles[profileKey];
  // Name
  document.getElementById('profile-name-display').textContent = profile.name || "";
  document.getElementById('profile-name-edit').value = profile.name || "";
  // Schedule
  document.getElementById('profile-schedule-display').textContent = profile.schedule || "";
  document.getElementById('profile-schedule-edit').value = profile.schedule || "";
  // Lunch
  document.getElementById('profile-lunch-display').textContent = profile.lunch || "";
  document.getElementById('profile-lunch-edit').value = profile.lunch || "";
  // Experience
  document.getElementById('profile-experience-display').textContent = profile.experience || "";
  document.getElementById('profile-experience-edit').value = profile.experience || "";
  // Current shift (show schedule)
  document.getElementById('profile-current-shift').textContent = profile.schedule || "-";
  // History
  renderShiftHistory(profileKey);
  document.getElementById('profile-login-section').classList.add('hidden');
  document.getElementById('profile-main-section').classList.remove('hidden');
  document.getElementById('profile-message').textContent = '';
  // Reset clock-in/out/break buttons
  document.getElementById('clock-in-btn').disabled = false;
  document.getElementById('start-break-btn').disabled = true;
  document.getElementById('end-break-btn').disabled = true;
  document.getElementById('clock-out-btn').disabled = true;
  document.getElementById('shift-status').textContent = '';
  currentShift = null;
}
function renderShiftHistory(profileKey) {
  const profiles = getProfiles();
  const shifts = profiles[profileKey]?.history || [];
  const cont = document.getElementById('profile-shift-history');
  if(!cont) return;
  if(!shifts || shifts.length === 0) {
    cont.innerHTML = "<em>No shifts yet.</em>";
    return;
  }
  // No edit/add/delete for regular users, just display
  cont.innerHTML = shifts.map((s,i) => `
    <div class="shift-history-block">
      <b>Shift #${shifts.length-i}</b> (${s.date})
      <ul>
        <li><b>Clocked In:</b> ${s.clockIn || "-"}</li>
        <li><b>Break Start:</b> ${s.breakStart || "-"}</li>
        <li><b>Break End:</b> ${s.breakEnd || "-"}</li>
        <li><b>Clocked Out:</b> ${s.clockOut || "-"}</li>
      </ul>
    </div>
  `).join('');
}
function saveCurrentProfileField(field, value) {
  if (!currentProfileKey) return;
  const profiles = getProfiles();
  profiles[currentProfileKey][field] = value;
  setProfiles(profiles);
}
// Profile login form
document.getElementById('profile-login-form').onsubmit = function(e) {
  e.preventDefault();
  const username = document.getElementById('profile-login-username').value.trim();
  const password = document.getElementById('profile-login-password').value;
  const profileObj = getProfileByUsername(username);
  if (profileObj && profileObj.password === password) {
    showProfileMain(profileObj.key);
  } else {
    document.getElementById('profile-login-message').textContent = "Invalid username or password.";
  }
};
document.getElementById('profile-logout-btn').onclick = showProfileLogin;
// Profile field edit/save/cancel logic
function enableEdit(field) {
  document.getElementById(`profile-${field}-display`).classList.add('hidden');
  document.getElementById(`profile-${field}-edit`).classList.remove('hidden');
  document.getElementById(`edit-profile-${field}-btn`).classList.add('hidden');
  document.getElementById(`save-profile-${field}-btn`).classList.remove('hidden');
  document.getElementById(`cancel-profile-${field}-btn`).classList.remove('hidden');
}
function disableEdit(field) {
  document.getElementById(`profile-${field}-display`).classList.remove('hidden');
  document.getElementById(`profile-${field}-edit`).classList.add('hidden');
  document.getElementById(`edit-profile-${field}-btn`).classList.remove('hidden');
  document.getElementById(`save-profile-${field}-btn`).classList.add('hidden');
  document.getElementById(`cancel-profile-${field}-btn`).classList.add('hidden');
}
function saveField(field) {
  let value;
  if(field==="experience") {
    value = document.getElementById(`profile-${field}-edit`).value;
    document.getElementById(`profile-${field}-display`).textContent = value;
  } else {
    value = document.getElementById(`profile-${field}-edit`).value;
    document.getElementById(`profile-${field}-display`).textContent = value;
  }
  saveCurrentProfileField(field, value);
  disableEdit(field);
  document.getElementById('profile-message').textContent = "Saved!";
  setTimeout(()=>document.getElementById('profile-message').textContent="", 1200);
}
['name','schedule','lunch','experience'].forEach(field => {
  document.getElementById(`edit-profile-${field}-btn`).onclick = ()=>enableEdit(field);
  document.getElementById(`cancel-profile-${field}-btn`).onclick = ()=>disableEdit(field);
  document.getElementById(`save-profile-${field}-btn`).onclick = ()=>saveField(field);
});

// ====== Shift clock in/out/break logic for regular users ======
document.getElementById('clock-in-btn').onclick = function() {
  if(currentShift) return;
  const now = new Date();
  currentShift = {
    date: now.toLocaleDateString(),
    clockIn: now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
    breakStart: null,
    breakEnd: null,
    clockOut: null
  };
  this.disabled = true;
  document.getElementById('start-break-btn').disabled = false;
  document.getElementById('end-break-btn').disabled = true;
  document.getElementById('clock-out-btn').disabled = false;
  document.getElementById('shift-status').textContent = "Shift started at " + currentShift.clockIn;
};
document.getElementById('start-break-btn').onclick = function() {
  if(!currentShift || currentShift.breakStart) return;
  const now = new Date();
  currentShift.breakStart = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
  this.disabled = true;
  document.getElementById('end-break-btn').disabled = false;
  document.getElementById('shift-status').textContent = "Break started at " + currentShift.breakStart;
};
document.getElementById('end-break-btn').onclick = function() {
  if(!currentShift || !currentShift.breakStart || currentShift.breakEnd) return;
  const now = new Date();
  currentShift.breakEnd = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
  this.disabled = true;
  document.getElementById('shift-status').textContent = "Break ended at " + currentShift.breakEnd;
};
document.getElementById('clock-out-btn').onclick = function() {
  if(!currentShift || currentShift.clockOut) return;
  const now = new Date();
  currentShift.clockOut = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
  updateProfileHistory(currentProfileKey, currentShift);
  renderShiftHistory(currentProfileKey);
  document.getElementById('clock-in-btn').disabled = false;
  document.getElementById('start-break-btn').disabled = true;
  document.getElementById('end-break-btn').disabled = true;
  this.disabled = true;
  document.getElementById('shift-status').textContent = "Clocked out at " + currentShift.clockOut + ". Shift saved!";
  currentShift = null;
};

// ========== NAVIGATION ==========
function hideAllDetails() {
  [
    "shifts-details", "announcements-details", "hire-details", 
    "admin-details", "calendar-details", "profile-details-section"
  ].forEach(id => {
    var e = document.getElementById(id);
    if(e) e.classList.add("hidden");
  });
  [
    "shifts-square", "announcements-square", "hire-square", 
    "admin-square", "calendar-square", "profile-square"
  ].forEach(id => {
    var e = document.getElementById(id);
    if(e) e.classList.remove("selected");
  });
}
document.getElementById('shifts-square').onclick = function() {
  hideAllDetails(); document.getElementById('shifts-details').classList.remove('hidden');
  this.classList.add('selected');
  renderShiftSquares();
  document.getElementById('profile-details').innerHTML = `<h3>Click a profile to see shift details</h3>`;
};
document.getElementById('announcements-square').onclick = function() {
  hideAllDetails(); document.getElementById('announcements-details').classList.remove('hidden');
  this.classList.add('selected');
  renderAnnouncements();
};
document.getElementById('hire-square').onclick = function() {
  hideAllDetails(); document.getElementById('hire-details').classList.remove('hidden');
  this.classList.add('selected');
};
document.getElementById('admin-square').onclick = function() {
  hideAllDetails(); document.getElementById('admin-details').classList.remove('hidden');
  this.classList.add('selected');
  document.getElementById('admin-login').classList.remove('hidden');
  document.getElementById('admin-panel').classList.add('hidden');
  document.getElementById('admin-login-message').textContent = '';
  document.getElementById('admin-code').value = '';
};
document.getElementById('calendar-square').onclick = function() {
  hideAllDetails();
  document.getElementById('calendar-details').classList.remove('hidden');
  this.classList.add('selected');
  // You should call your renderCalendar function here (not included in this snippet)
};
document.getElementById('profile-square').onclick = function() {
  hideAllDetails();
  document.getElementById('profile-details-section').classList.remove('hidden');
  this.classList.add('selected');
  showProfileLogin();
};
</body>
</html>
